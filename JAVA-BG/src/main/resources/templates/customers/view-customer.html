<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments :: head}">
    <title>Customer Details</title>
</head>
<body>
<header th:replace="~{fragments :: header}"></header>
<nav th:replace="~{fragments :: navigation}"></nav>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <!-- Header with actions -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">
                    <i class="bi bi-person-circle me-2"></i>Customer Details
                </h2>
                <div>
                    <a href="/customers" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left me-1"></i>Back to List
                    </a>
                    <a th:href="@{/customers/edit/{id}(id=${customer.id})}" 
                       class="btn btn-outline-primary"
                       sec:authorize="hasRole('ADMIN')">
                        <i class="bi bi-pencil me-1"></i>Edit
                    </a>
                </div>
            </div>

            <!-- Customer Information Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0" th:text="${customer.name}">Customer Name</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <strong>Customer ID:</strong><br>
                            <span th:text="${customer.id}">1</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Age:</strong><br>
                            <span th:text="${customer.age}">30</span> years old
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Email:</strong><br>
                            <a th:href="'mailto:' + ${customer.email}" th:text="${customer.email}">email@example.com</a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Phone:</strong><br>
                            <span th:text="${customer.phone ?: 'Not provided'}">+1234567890</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Date of Birth:</strong><br>
                            <span th:text="${customer.dateOfBirth != null ? #temporals.format(customer.dateOfBirth, 'MMM dd, yyyy') : 'Not provided'}">Jan 01, 1990</span>
                        </div>
                        <div class="col-md-6 mb-3">
                            <strong>Insurance Number:</strong><br>
                            <span th:text="${customer.insuranceNumber ?: 'Not provided'}">INS123456</span>
                        </div>
                        <div class="col-md-12 mb-3">
                            <strong>Address:</strong><br>
                            <span th:text="${customer.address ?: 'Not provided'}">123 Main St, City, State</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Information Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-warning">
                    <h5 class="mb-0">
                        <i class="bi bi-shield-exclamation me-2"></i>Medical Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            <strong>Allergies:</strong><br>
                            <div th:if="${customer.allergies != null and !customer.allergies.isEmpty()}">
                                <span class="badge bg-danger me-1">
                                    <i class="bi bi-exclamation-triangle"></i> Allergy Alert
                                </span>
                                <p class="mt-2 mb-0" th:text="${customer.allergies}">List of allergies</p>
                            </div>
                            <div th:if="${customer.allergies == null or customer.allergies.isEmpty()}">
                                <span class="badge bg-success">No known allergies</span>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <strong>Medical History:</strong><br>
                            <p th:if="${customer.medicalHistory != null and !customer.medicalHistory.isEmpty()}" 
                               th:text="${customer.medicalHistory}">
                                Medical history details
                            </p>
                            <span th:if="${customer.medicalHistory == null or customer.medicalHistory.isEmpty()}" 
                                  class="text-muted">
                                No medical history recorded
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prescriptions Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-file-medical me-2"></i>Prescriptions
                        <span class="badge bg-light text-dark ms-2" 
                              th:text="${customer.recipes != null ? customer.recipes.size() : 0}">0</span>
                    </h5>
                </div>
                <div class="card-body">
                    <div th:if="${customer.recipes == null or customer.recipes.isEmpty()}" class="text-center py-3">
                        <p class="text-muted mb-0">No prescriptions found for this customer</p>
                    </div>

                    <div th:unless="${customer.recipes == null or customer.recipes.isEmpty()}">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date</th>
                                        <th>Doctor</th>
                                        <th>Status</th>
                                        <th>Diagnosis</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="recipe : ${customer.recipes}">
                                        <td th:text="${recipe.id}">1</td>
                                        <td th:text="${recipe.creationDate != null ? #temporals.format(recipe.creationDate, 'MMM dd, yyyy') : 'N/A'}">Jan 15, 2026</td>
                                        <td th:text="${recipe.doctor?.name ?: 'Unknown'}">Dr. Smith</td>
                                        <td>
                                            <span th:if="${recipe.status != null}" 
                                                  class="badge"
                                                  th:classappend="${recipe.status.name() == 'ACTIVE'} ? 'bg-success' : (${recipe.status.name() == 'FULFILLED'} ? 'bg-primary' : (${recipe.status.name() == 'EXPIRED'} ? 'bg-danger' : 'bg-secondary'))"
                                                  th:text="${recipe.status}">
                                                ACTIVE
                                            </span>
                                        </td>
                                        <td th:text="${recipe.diagnosis ?: 'Not specified'}">Diagnosis</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<footer th:replace="~{fragments :: footer}"></footer>
</body>
</html>
